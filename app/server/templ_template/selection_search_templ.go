// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.960
package templ_template

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

func SelectionSearchScript() templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<script>\n\tconst initPopupManager = (function() {\n\t\tif (window.dhee && window.dhee.popupManager) {\n\t\t\treturn; // Already initialized\n\t\t}\n\n\t\twindow.dhee = window.dhee || {};\n\n\t\tconst popupManager = (function() {\n\t\t\tlet activePopup = null;\n\n\t\t\tfunction close() {\n\t\t\t\tif (activePopup) {\n\t\t\t\t\tactivePopup.remove();\n\t\t\t\t\tactivePopup = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Close popups on outside click\n\t\t\tdocument.addEventListener('click', function(e) {\n\t\t\t\tif (activePopup && !activePopup.contains(e.target) && !e.target.closest('.pada-word') && !e.target.closest('.table-word')) {\n\t\t\t\t\tclose();\n\t\t\t\t}\n\t\t\t\tconst resultWindow = document.querySelector('.search-result-window');\n                if (resultWindow && !resultWindow.contains(e.target) && !e.target.closest('.roman-selection-popup')) {\n                    resultWindow.remove();\n                }\n\t\t\t});\n\t\t\t\n\t\t\treturn {\n\t\t\t\tset: function(popup) {\n\t\t\t\t\tclose();\n\t\t\t\t\tactivePopup = popup;\n\t\t\t\t},\n\t\t\t\tclose: close,\n\t\t\t\tget: function() {\n\t\t\t\t\treturn activePopup;\n\t\t\t\t},\n\t\t\t};\n\t\t})();\n\n\t\twindow.dhee.popupManager = popupManager;\n\n\t\tfunction makeDraggable(element) {\n\t\t\tlet pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;\n\t\t\tconst dragHandle = element.querySelector('.search-result-title-bar');\n\t\t\tif (!dragHandle) { return; }\n\t\t\tdragHandle.onmousedown = dragMouseDown;\n\n\t\t\tfunction dragMouseDown(e) {\n\t\t\t\tif (e.target.tagName === 'A' || e.target.tagName === 'BUTTON' || e.target.closest('a, button')) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\te = e || window.event;\n\t\t\t\te.preventDefault();\n\t\t\t\tpos3 = e.clientX;\n\t\t\t\tpos4 = e.clientY;\n\t\t\t\tdocument.onmouseup = closeDragElement;\n\t\t\t\tdocument.onmousemove = elementDrag;\n\t\t\t}\n\n\t\t\tfunction elementDrag(e) {\n\t\t\t\te = e || window.event;\n\t\t\t\te.preventDefault();\n\t\t\t\tpos1 = pos3 - e.clientX;\n\t\t\t\tpos2 = pos4 - e.clientY;\n\t\t\t\tpos3 = e.clientX;\n\t\t\t\tpos4 = e.clientY;\n\t\t\t\telement.style.top = (element.offsetTop - pos2) + \"px\";\n\t\t\t\telement.style.left = (element.offsetLeft - pos1) + \"px\";\n\t\t\t}\n\n\t\t\tfunction closeDragElement() {\n\t\t\t\tdocument.onmouseup = null;\n\t\t\t\tdocument.onmousemove = null;\n\t\t\t}\n\t\t}\n\n\t\twindow.dhee.setupTextSelectionSearch = function(elementId, transliteration, fuzziness) {\n\t\t\tconst DHEE_TL_PREF_KEY = 'dhee-tl-pref';\n\t\t\tconst textEl = document.getElementById(elementId);\n\t\t\tif (!textEl) return;\n\n\t\t\ttextEl.addEventListener('mouseup', function (e) {\n\t\t\t\tconst searchResultWindow = document.querySelector('.search-result-window');\n\t\t\t\tif (searchResultWindow && searchResultWindow.contains(e.target)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twindow.dhee.popupManager.close();\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tconst selection = window.getSelection();\n\t\t\t\t\tif (!selection.rangeCount) return;\n\t\t\t\t\tconst selectedText = selection.toString().trim();\n\n\t\t\t\t\tif (selectedText.length > 0 && (selectedText.match(/\\s/g) || []).length <= 2) {\n\t\t\t\t\t\tconst range = selection.getRangeAt(0);\n\t\t\t\t\t\tconst rect = range.getBoundingClientRect();\n\n\t\t\t\t\t\tif (e.target.closest('.pada-popup, .table-word-popup, .roman-selection-popup')) return;\n\n\t\t\t\t\t\tconst popup = document.createElement('div');\n\t\t\t\t\t\tpopup.className = 'roman-selection-popup card';\n\t\t\t\t\t\tpopup.style.position = 'absolute';\n\t\t\t\t\t\tpopup.style.zIndex = 1050;\n\t\t\t\t\t\tpopup.style.width = '300px';\n\n\t\t\t\t\t\tconst cardBody = document.createElement('div');\n\t\t\t\t\t\tcardBody.className = 'card-body p-2';\n\n\t\t\t\t\t\tconst inputGroup = document.createElement('div');\n\t\t\t\t\t\tinputGroup.className = 'input-group input-group-sm';\n\n\t\t\t\t\t\tconst preferredTl = localStorage.getItem(DHEE_TL_PREF_KEY) || 'slp1';\n\t\t\t\t\t\tconst textInput = document.createElement('input');\n\t\t\t\t\t\ttextInput.type = 'text';\n\t\t\t\t\t\ttextInput.className = 'form-control';\n\t\t\t\t\t\ttextInput.value = window.dhee.transliterator.convertNormalized(selectedText, transliteration, preferredTl);\n\n\t\t\t\t\t\tconst tlSelect = document.createElement('select');\n\t\t\t\t\t\ttlSelect.className = 'form-select';\n\t\t\t\t\t\ttlSelect.innerHTML = `\n\t\t\t\t\t\t\t<option value=\"slp1\">SLP1</option>\n\t\t\t\t\t\t\t<option value=\"iast\">IAST</option>\n\t\t\t\t\t\t\t<option value=\"hk\">Kyoto-Harvard</option>\n\t\t\t\t\t\t\t<option value=\"dn\">Devanagari</option>\n\t\t\t\t\t\t`;\n\t\t\t\t\t\ttlSelect.value = preferredTl;\n\n\t\t\t\t\t\tinputGroup.appendChild(textInput);\n\t\t\t\t\t\tinputGroup.appendChild(tlSelect);\n\n\t\t\t\t\t\tconst bottomRow = document.createElement('div');\n\t\t\t\t\t\tbottomRow.className = 'd-flex justify-content-between align-items-center mt-2';\n\n\t\t\t\t\t\tconst suggestionEl = document.createElement('div');\n\t\t\t\t\t\tsuggestionEl.className = 'form-text text-muted';\n\t\t\t\t\t\tsuggestionEl.style.minHeight = '1.2rem';\n\n\t\t\t\t\t\tconst searchButton = document.createElement('button');\n\t\t\t\t\t\tsearchButton.className = 'btn btn-sm btn-primary';\n\t\t\t\t\t\tsearchButton.textContent = 'Search';\n\n\t\t\t\t\t\tbottomRow.appendChild(suggestionEl);\n\t\t\t\t\t\tbottomRow.appendChild(searchButton);\n\n\t\t\t\t\t\tcardBody.appendChild(inputGroup);\n\t\t\t\t\t\tcardBody.appendChild(bottomRow);\n\t\t\t\t\t\tpopup.appendChild(cardBody);\n\t\t\t\t\t\tdocument.body.appendChild(popup);\n\n\t\t\t\t\t\tconst popupRect = popup.getBoundingClientRect();\n\t\t\t\t\t\tpopup.style.left = `${rect.right + window.scrollX - popupRect.width}px`;\n\t\t\t\t\t\tpopup.style.top = `${rect.bottom + window.scrollY + 5}px`;\n\n\t\t\t\t\t\twindow.dhee.popupManager.set(popup);\n\n\t\t\t\t\t\tlet currentTl = preferredTl;\n\n\t\t\t\t\t\tfunction updateSuggestion() {\n\t\t\t\t\t\t\tconst query = textInput.value;\n\t\t\t\t\t\t\tconst sourceTl = tlSelect.value;\n\t\t\t\t\t\t\tif (query.trim() === '' || sourceTl === 'iast') {\n\t\t\t\t\t\t\t\tsuggestionEl.innerHTML = '';\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst iast = window.dhee.transliterator.convertNormalized(query, sourceTl, TlIAST);\n\t\t\t\t\t\t\t\tsuggestionEl.innerHTML = `ðŸ”Ž ${iast}`;\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tconsole.error(\"Transliteration failed\", e);\n\t\t\t\t\t\t\t\tsuggestionEl.innerHTML = '';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttextInput.addEventListener('input', updateSuggestion);\n\t\t\t\t\t\ttlSelect.addEventListener('change', () => {\n\t\t\t\t\t\t\tconst newTl = tlSelect.value;\n\t\t\t\t\t\t\ttextInput.value = window.dhee.transliterator.convertNormalized(textInput.value, currentTl, newTl);\n\t\t\t\t\t\t\tcurrentTl = newTl;\n\t\t\t\t\t\t\tupdateSuggestion();\n\t\t\t\t\t\t});\n\t\t\t\t\t\tupdateSuggestion();\n\n\t\t\t\t\t\tsearchButton.addEventListener('click', function () {\n\t\t\t\t\t\t\twindow.dhee.popupManager.close();\n\n\t\t\t\t\t\t\tconst existingResultWindow = document.querySelector('.search-result-window');\n\t\t\t\t\t\t\tif (existingResultWindow) {\n\t\t\t\t\t\t\t\texistingResultWindow.remove();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst query = textInput.value;\n\t\t\t\t\t\t\tconst tl = tlSelect.value;\n\t\t\t\t\t\t\tconst url = `/dictionaries/monier-williams/search?q=${encodeURIComponent(query)}&tl=${tl}&mode=fuzzy&preview=true&fuzziness=${fuzziness}`;\n\t\t\t\t\t\t\tfetch(url)\n\t\t\t\t\t\t\t\t.then(response => response.text())\n\t\t\t\t\t\t\t\t.then(html => {\n\t\t\t\t\t\t\t\t\tconst resultWindow = document.createElement('div');\n\t\t\t\t\t\t\t\t\tresultWindow.className = 'search-result-window';\n\n\t\t\t\t\t\t\t\t\tconst titleBar = document.createElement('div');\n\t\t\t\t\t\t\t\t\ttitleBar.className = 'search-result-title-bar';\n\n\t\t\t\t\t\t\t\t\tconst closeButton = document.createElement('button');\n\t\t\t\t\t\t\t\t\tcloseButton.className = 'btn-close';\n\t\t\t\t\t\t\t\t\tcloseButton.setAttribute('aria-label', 'Close');\n\t\t\t\t\t\t\t\t\ttitleBar.appendChild(closeButton);\n\n\t\t\t\t\t\t\t\t\tconst contentDiv = document.createElement('div');\n\t\t\t\t\t\t\t\t\tcontentDiv.className = 'search-result-content';\n\t\t\t\t\t\t\t\t\tcontentDiv.innerHTML = html;\n\n\t\t\t\t\t\t\t\t\tresultWindow.appendChild(titleBar);\n\t\t\t\t\t\t\t\t\tresultWindow.appendChild(contentDiv);\n\n\t\t\t\t\t\t\t\t\tdocument.body.appendChild(resultWindow);\n\n\t\t\t\t\t\t\t\t\tcloseButton.onclick = function () {\n\t\t\t\t\t\t\t\t\t\tresultWindow.remove();\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\tmakeDraggable(resultWindow);\n\t\t\t\t\t\t\t\t}).catch(err => console.error(\"Failed to fetch search preview:\", err));\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}, 10);\n\t\t\t});\n\t\t}\n\t});\n\tif (typeof preInit === \"undefined\") {\n\t\tpreInit = [];\n\t}\n\tpreInit.push(initPopupManager);\n\t</script>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
